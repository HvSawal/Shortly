spring:
  application:
    name: shortener-backend

  threads:
    virtual:
      enabled: true

  datasource:
    url: jdbc:postgresql://localhost:5433/shortener
    username: shortener
    password: shortener
    hikari:
      maximum-pool-size: 10
      minimum-idle: 0
      connection-timeout: 1000
      validation-timeout: 1000

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate.jdbc.time_zone: UTC

  flyway:
    enabled: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true

shortener:
  public-base-url: ${SHORTENER_PUBLIC_BASE_URL:http://localhost:8080}
  scramble:
    key: ${SHORTENER_SCRAMBLE_KEY:}
    rounds: 5
    min-len: 6
  expiration-years: 2

  cache:
    resolve-ttl-seconds: 600
    max-size: 10000

  bulkhead:
    db-permits: 10
    acquire-timeout-ms:
      shorten: 50
      resolve: 10

  ratelimit:
    shorten-per-minute: 240

  clickcount:
    enabled: true
    flush-interval-ms: 1000
    max-buffer-entries: 100000

  code:
    v2:
      enabled: true
      prefix: "_"        # must NOT be Base62 char to avoid ambiguity
      min-length: 5
      max-length: 10
      start-id: ${SHORTENER_CODE_V2_START_ID:9223372036854775807}
      key: ${SHORTENER_SCRAMBLE_KEY:dev-only-change-me}

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173}

server:
  port: 8080
